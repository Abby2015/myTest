var Bmh={};Bmh.Page1=Bmh.Page2=Bmh.Page3=Bmh.Page4=Bmh.Page5=Bmh.Page6=Bmh.Page7=Bmh.Page8=Bmh.Page9={};Bmh={init:function(b){for(var a=1;a<=9;a++){Bmh["Page"+a].init(b);}b.find(".share").bind("touchstart",function(){setTimeout(function(){b.find(".share").hide();var c={sid:Bmh.getSid(),channelType:Bmh.getChannelType(),userId:Bmh.getOpenid(),deviceType:Bmh.getDeviceType(),mediaType:"WX",shareResult:1,shareUrl:""};amGloble.api.a03.post(c,function(d){if(amGloble.config.debug==true){alert("[-a03- return]"+JSON.stringify(d));}if(d.content.errCode!=0){if(amGloble.config.debug==true){alert(JSON.stringify(d));}}else{}},"application/json; charset=utf-8");c={sid:Bmh.getSid(),channelType:Bmh.getChannelType(),userId:Bmh.getOpenid(),deviceType:Bmh.getDeviceType()};if(amGloble.config.debug==true){alert("[-a06- input]"+JSON.stringify(c));}amGloble.api.a06.post(c,function(d){if(amGloble.config.debug==true){alert("[-a06- return]"+JSON.stringify(d));}if(d.content.errCode!=0){if(amGloble.config.debug==true){alert(JSON.stringify(d));}Bmh.toCardBag();}else{if(amGloble.config.debug==true){alert(typeof d.content.data.win+"win="+d.content.data.win);}Bmh.toCardBag();}},"application/json; charset=utf-8");},100);});b.find("#prizeForm  .cont").bind("touchstart",function(){$("#prizeForm  input").focus();});b.find("#prizeForm  .submit").bind("touchstart",function(){$("#errorTips").hide();var e=$.trim($("#prizeForm input").val());if(e==""){$("#prizeForm input").focus();$("#errorTips").text("手机号码不能为空！").show();return false;}var g=/^13\d{9}$/,f=/^15[^4]\d{8}$/,d=/^1[78]\d{9}$/;var c=e.match(g)||e.match(f)||e.match(d);if(!c){$("#prizeForm input").val("");$("#prizeForm input").focus();$("#errorTips").text("手机号码有误！").show();return false;}opt={sid:Bmh.getSid(),channelType:Bmh.getChannelType(),userId:Bmh.getOpenid(),phone:e};if(amGloble.config.debug==true){alert("[-a07- input]"+JSON.stringify(opt));}amGloble.api.a07.post(opt,function(h){if(amGloble.config.debug==true){alert("[-a07- return]"+JSON.stringify(h));}if(h.content.errCode!=0){if(amGloble.config.debug==true){alert(JSON.stringify(h));}}else{setTimeout(function(){location.href=amGloble.config.selfRoot+"pages/bmh1506/index.html";},100);}},"application/json; charset=utf-8");});b.find("#prizeTips").bind("touchstart",function(){b.find(".overlay").hide();$(this).hide();setTimeout(function(){location.href=amGloble.config.selfRoot+"pages/bmh1506/index.html";},100);});if(this.isRedirect()){Bmh.goToPage(6);}else{}},isRedirect:function(){var b=localStorage.getItem("localPromoCode");var a=localStorage.getItem("gameScore");if(b==null||a==null){return false;}else{return true;}},goToPage:function(a){var c="";switch(a){case 1:c="进入活动首页";break;case 2:c="进入游戏向导页面";break;case 3:c="进入游戏页面";break;case 4:c="";break;case 5:c="";break;case 6:c="进入半价券页面";break;case 7:c="进入无券页面";break;case 8:c="进入失败页面";break;case 9:c="进入产品介绍页面";break;}Bmh.saveOpenRecord(c);for(var b=1;b<=9;b++){if(b==a){$(".page"+b).show();if(b==3){Game.init();}if(b==6||b==7||b==8){Bmh["Page"+b].initGameScore();}}else{$(".page"+b).hide();}}},share:function(){$(".overlay").show();$(".share").show();},saveOpenRecord:function(a){var b=this;if(window._tag){_tag.dcsMultiTrack("wt.event",a,"wt.msg",b.getOpenid());}},getOpenid:function(){var a=localStorage.getItem("openid");if(a==null||a==""||a=="null"){a=amGloble.getQueryParameter("openid");localStorage.setItem("openid",a);}return a;},getChannelType:function(){var a=sessionStorage.getItem("channelType");if(a==null||a==""||a=="null"){a=amGloble.getQueryParameter("channelType");sessionStorage.setItem("channelType",a);}return a;},getDeviceType:function(){var a=sessionStorage.getItem("deviceType");if(a==null||a==""||a=="null"){a=amGloble.getQueryParameter("deviceType");sessionStorage.setItem("deviceType",a);}return a;},getDeviceId:function(){var a=localStorage.getItem("deviceid");if(a==null||a==""||a=="null"){a=amGloble.guid();localStorage.setItem("deviceid",a);}return a;},getSid:function(){return sessionStorage.getItem("sid");},toCardBag:function(){var a={promoCode:sessionStorage.getItem("promoCode")};if(amGloble.config.debug==true){alert("[-a05- input]"+JSON.stringify(a));}amGloble.api.a05.post(a,function(c){if(amGloble.config.debug==true){alert("[-a05- return]"+JSON.stringify(c));}if(c.content.errCode!=0){if(amGloble.config.debug==true){alert(JSON.stringify(c));}}else{var b="http://crmminisite.verystar.cn/wxcard/promo?key="+c.content.data.data+"&wechat_card_js=1";if(amGloble.config.debug==true){alert(b);}location.href=b;}},"application/json; charset=utf-8");}};Bmh.Page1={init:function(a){Bmh.saveOpenRecord("进入活动首页");a.find(".start_button").bind("touchstart",function(){Bmh.goToPage(2);});a.find(".page1 .ticket_button").bind("touchstart",function(){if(amGloble.config.debug==true){alert(typeof sessionStorage.getItem("promoCode")+",promoCode="+sessionStorage.getItem("promoCode"));}if(sessionStorage.getItem("promoCode")==""||sessionStorage.getItem("promoCode")==null){Bmh.goToPage(2);}else{Bmh.toCardBag();}});a.find(".know_button").bind("touchstart",function(){Bmh.goToPage(9);});a.find(".rule_button").bind("touchstart",function(){a.find(".overlay").show();a.find(".rule_pop").show();new IScroll("#wrapper");});a.find(".rule_pop .close").bind("touchstart",function(){a.find(".overlay").hide();a.find(".rule_pop").hide();});}};Bmh.Page2={init:function(a){a.find(".page2").bind("touchstart",function(){Bmh.goToPage(3);});}};Bmh.Page3={init:function(a){}};Bmh.Page4={init:function(a){}};Bmh.Page5={init:function(a){}};Bmh.Page6={initGameScore:function(){var b=localStorage.getItem("gameScore");var a=localStorage.getItem("localPromoCode");$(".page6 .num").text(b+"次");$("#pcode").html(a);},init:function(a){a.find(".page6 .ticket_button").bind("touchstart",function(){Bmh.toCardBag();});a.find(".page6 .look_button").bind("touchstart",function(){Bmh.share();$(".page6").hide();});a.find(".page6 .show_button").bind("touchstart",function(){Bmh.share();$(".page6").hide();});a.find(".page6 .again_button1").bind("touchstart",function(){$("title").html("爆米花爱上花淇淋");Bmh.goToPage(3);});}};Bmh.Page7={initGameScore:function(){var a=localStorage.getItem("gameScore");$(".page7 .num").text(a+"次");},init:function(a){a.find(".page7").bind("touchstart",function(){Bmh.share();$(".page7").hide();});}};Bmh.Page8={initGameScore:function(){var a=localStorage.getItem("gameScore");$(".page8 .num").text(a+"次");},init:function(a){a.find(".page8 .again_button1").bind("touchstart",function(){$("title").html("爆米花爱上花淇淋");Bmh.goToPage(3);});a.find(".page8 .guys_button1").bind("touchstart",function(){Bmh.share();$(".page8").hide();});}};Bmh.Page9={init:function(a){a.find(".page9").bind("touchstart",function(){Bmh.goToPage(1);});}};$(function(){Bmh.init($(".am-app"));});
