<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yum.kfc.brand.dzp1807.dao.Dzp1807DrawMapper">
	
	<insert id="saveDraw" parameterType="com.yum.kfc.brand.dzp1807.pojo.Dzp1807Draw">
		<bind name= "tbl_sid" value="@com.yum.kfc.brand.common.utils.MybatisTblShardStrategy@byLastDigitOrLenMod10(#{ssoUserId})" />
		INSERT INTO dzp1807_draw_${tbl_sid}
			([orderId],[userId],[ssoUserId],[crmUserCode],[phone],[channelType],[deviceType],[winAward],[awardType],[awardCodeId],[ipAddr],[drawTime],[awardName],[awardLevel],[winImg],[personalImg],[isFree],[couponType],[url])
		VALUES
			(#{orderId},#{userId},#{ssoUserId},#{crmUserCode},#{phone},#{channelType},#{deviceType},#{winAward},#{awardType},#{awardCode},#{ipAddr},#{drawTime},#{awardName},#{awardLevel},#{winImg},#{personalImg},#{isFree},#{couponType},#{url})
	</insert>

    <select id="getUserDrawCount" resultType="long">
    	<bind name= "tbl_sid" value="@com.yum.kfc.brand.common.utils.MybatisTblShardStrategy@byLastDigitOrLenMod10(#{ssoUserId})" />
		select count(*) from dzp1807_draw_${tbl_sid} with(nolock)
    		where ssoUserId=#{ssoUserId}
    		<if test="beginTime!=null"> and drawTime>=#{beginTime} and #{endTime}>=drawTime</if>
	</select>
	
	<select id="getUserAwardWinCount" resultType="long">
    	<bind name= "tbl_sid" value="@com.yum.kfc.brand.common.utils.MybatisTblShardStrategy@byLastDigitOrLenMod10(#{ssoUserId})" />
		select count(*) from dzp1807_draw_${tbl_sid} with(nolock)
    		where ssoUserId=#{ssoUserId} and awardType=#{awardType}
	</select>
	
	<select id="getUserDrawRecord" resultType="com.yum.kfc.brand.dzp1807.pojo.Dzp1807Draw">
    	<bind name= "tbl_sid" value="@com.yum.kfc.brand.common.utils.MybatisTblShardStrategy@byLastDigitOrLenMod10(#{ssoUserId})" />
		select * from dzp1807_draw_${tbl_sid} with(nolock)
    		where ssoUserId=#{ssoUserId} and drawTime>=#{beginTime} order by drawTime desc
	</select>
    
</mapper>